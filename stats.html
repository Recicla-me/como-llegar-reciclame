<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Estad√≠sticas QR - Rec√≠clame</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0f172a;
      color: #f9fafb;
      margin: 0;
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }
    .container {
      background: #020617;
      border-radius: 20px;
      padding: 24px;
      max-width: 900px;
      width: 100%;
      box-shadow: 0 20px 40px rgba(0,0,0,0.4);
      border: 1px solid rgba(148,163,184,0.2);
    }
    h1 {
      margin-top: 0;
      text-align: center;
      font-size: 24px;
      margin-bottom: 4px;
    }
    .subtitle {
      text-align: center;
      font-size: 14px;
      color: #9ca3af;
      margin-bottom: 24px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 16px;
      margin-bottom: 20px;
    }
    .card {
      background: #020617;
      border-radius: 16px;
      padding: 16px 18px;
      border: 1px solid rgba(148,163,184,0.3);
    }
    .label {
      font-size: 14px;
      color: #9ca3af;
      margin-bottom: 6px;
    }
    .value {
      font-size: 32px;
      font-weight: 700;
      display: flex;
      align-items: baseline;
      gap: 6px;
    }
    .value span {
      font-size: 14px;
      font-weight: 400;
      color: #9ca3af;
    }
    .tag {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      border: 1px solid rgba(148,163,184,0.4);
      color: #e5e7eb;
      margin-top: 6px;
    }
    .tag.green {
      border-color: #22c55e;
      color: #bbf7d0;
    }
    .footer {
      text-align: center;
      font-size: 12px;
      color: #6b7280;
      margin-top: 10px;
    }
    .status {
      text-align: center;
      font-size: 13px;
      margin-bottom: 12px;
      color: #9ca3af;
    }
    .status.error {
      color: #fecaca;
    }
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15,118,110,0.18);
      border: 1px solid rgba(45,212,191,0.4);
      font-size: 11px;
      color: #a5f3fc;
      margin-bottom: 12px;
    }
    .back-link {
      display: inline-block;
      margin-bottom: 12px;
      font-size: 12px;
      color: #a5b4fc;
      text-decoration: none;
    }
    .back-link:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="container">
    <a class="back-link" href="./">‚Üê Volver a la p√°gina del QR</a>

    <div class="pill">
      üîí Panel de solo lectura ¬∑ Datos en vivo desde Firebase
    </div>

    <h1>Estad√≠sticas QR ¬∑ Rec√≠clame</h1>
    <div class="subtitle">
      C/ Se√∫l, 14 ¬∑ Humanes de Madrid ¬∑ Madrid, 28970
    </div>

    <div id="status" class="status">Cargando datos en tiempo real‚Ä¶</div>

    <div class="grid">
      <div class="card">
        <div class="label">Visitas a la p√°gina (escaneos del QR)</div>
        <div class="value" id="visits-value">‚Äì</div>
        <div class="tag green">Total acumulado</div>
      </div>

      <div class="card">
        <div class="label">Clics en Google Maps</div>
        <div class="value" id="google-value">‚Äì</div>
        <div class="tag">Google Maps‚Äù</div>
      </div>

      <div class="card">
        <div class="label">Clics en Apple Maps</div>
        <div class="value" id="apple-value">‚Äì</div>
        <div class="tag">Apple Maps‚Äù</div>
      </div>
    </div>

    <div class="footer">
      Datos servidos por Firebase Firestore ¬∑ Proyecto: <strong>qr-reciclame</strong>
    </div>
  </div>

  <!-- Firebase + Firestore solo lectura -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import {
      getFirestore,
      doc,
      getDoc
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // MISMO CONFIG QUE EN index.html
    const firebaseConfig = {
      apiKey: "AIzaSyDpY0Hqd_IU88ilrPK0da92U_mvPAcTYIg",
      authDomain: "qr-reciclame.firebaseapp.com",
      projectId: "qr-reciclame",
      storageBucket: "qr-reciclame.firebasestorage.app",
      messagingSenderId: "801108546220",
      appId: "1:801108546220:web:f8519a5596dc0ef0384509"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const statusEl = document.getElementById("status");
    const visitsEl = document.getElementById("visits-value");
    const googleEl = document.getElementById("google-value");
    const appleEl = document.getElementById("apple-value");

    async function loadStats() {
      try {
        const ref = doc(db, "metrics", "counters");
        const snap = await getDoc(ref);

        if (!snap.exists()) {
          statusEl.textContent = "No se han encontrado datos todav√≠a.";
          visitsEl.textContent = "0";
          googleEl.textContent = "0";
          appleEl.textContent = "0";
          return;
        }

        const data = snap.data();
        visitsEl.textContent = data.visits ?? 0;
        googleEl.textContent = data.google ?? 0;
        appleEl.textContent = data.apple ?? 0;

        statusEl.textContent = "Datos cargados correctamente ‚úÖ";

      } catch (error) {
        console.error("Error al cargar estad√≠sticas:", error);
        statusEl.textContent = "Error al cargar estad√≠sticas desde Firestore.";
        statusEl.classList.add("error");
        visitsEl.textContent = "‚Äî";
        googleEl.textContent = "‚Äî";
        appleEl.textContent = "‚Äî";
      }
    }

    loadStats();
  </script>
</body>
</html>
